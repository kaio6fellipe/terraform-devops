# Lint Terraform with .tflint.hcl configs

CHECKOV=$(command -v checkov)
TFLINT=$(command -v tflint)
TFSEC=$(command -v tfsec)

echo "Setup requirements.txt"
pip install -r requirements.txt
echo "Linting with Checkov"
"${CHECKOV}" --directory . --var-file config/dev/terraform.tfvars --skip-path .github/ --framework Terraform

echo "Start tflint"
echo "Installing tflint"
curl -s https://raw.githubusercontent.com/terraform-linters/tflint/master/install_linux.sh | bash
echo "Initialize tflint"
"${TFLINT}" --init
echo "Linting..."
"${TFLINT}" --var-file=./config/dev/terraform.tfvars --module
echo "Finish tflint"

echo "Start tfsec"
echo "Installing tfsec"
curl -s https://raw.githubusercontent.com/aquasecurity/tfsec/master/scripts/install_linux.sh | bash
echo "Linting..."
"${TFSEC}" . --tfvars-file config/dev/terraform.tfvars