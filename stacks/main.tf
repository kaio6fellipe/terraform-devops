module "platform" {
  source                       = "./platform"
  instance_type                = local.instance_type
  ansible_instance_type        = local.ansible_instance_type
  db_instance_type             = local.db_instance_type
  rds_allocated_storage        = local.rds_allocated_storage
  rds_max_allocated_storage    = local.rds_max_allocated_storage
  environment                  = local.environment
  region                       = local.region
  amazon_linux_2               = data.aws_ami.amazon_linux_2.id
  key_name                     = "${local.key_name}-${local.environment}"
  vpc_id                       = local.vpc_id
  vpc_private_subnets          = local.vpc_private_subnets
  vpc_public_subnets           = local.vpc_public_subnets
  vpc_intra_subnets            = local.vpc_intra_subnets
  availability_zone_0          = local.availability_zone_0
  private_subnet_id_0          = local.private_subnet_id_0
  availability_zone_1          = local.availability_zone_1
  private_subnet_id_1          = local.private_subnet_id_1
  availability_zone_2          = local.availability_zone_2
  private_subnet_id_2          = local.private_subnet_id_2
  public_subnet_id_0           = local.public_subnet_id_0
  public_subnet_id_1           = local.public_subnet_id_1
  public_subnet_id_2           = local.public_subnet_id_2
  private_subnet_cidr_block_0  = local.private_subnet_cidr_block_0
  database_subnet_id_0         = local.database_subnet_id_0
  db_subnet_group_name         = local.db_subnet_group_name
  vpc_cidr                     = local.vpc_cidr
  SSH_PRIVATE_KEY              = var.SSH_PRIVATE_KEY
  AWS_RDS_PASSWORD             = var.AWS_RDS_PASSWORD
  ANSIBLE_VAULT_PASSWORD       = var.ANSIBLE_VAULT_PASSWORD
  ADMIN_USER_ARN               = var.ADMIN_USER_ARN
  ADMIN_USER_NAME              = var.ADMIN_USER_NAME
  private_dns_zone_id          = data.aws_route53_zone.private_zone.zone_id
  ktech_devops_private_zone_id = data.aws_route53_zone.ktech_devops_private_zone.zone_id
  private_dns_zone_name        = sort(keys(module.zones.route53_zone_zone_id))[0]
  private_dns_zone_arn         = sort(keys(module.zones.route53_zone_zone_arn))[0]
  GITHUB_ACTIONS_CIDR          = var.GITHUB_ACTIONS_CIDR
  platform_eks_services        = local.platform_eks_services
}
